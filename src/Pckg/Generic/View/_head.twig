{% do _metaManager.addViewport() %}
{% do _metaManager.addContentType() %}

{{ _gtmManager | raw }}

{{ _metaManager.getMeta('header.first') | raw }}

{{ _seoManager | raw }}

{{ _metaManager.getMeta('header') | raw }}

<!-- libraries css, less, js, main css, less, js -->
{{ _assetManager.getMeta(['css', 'less', 'js'], ['libraries', 'main']) | raw }}

<script>
    var Pckg = Pckg || {};
    Pckg.data = {};
    Pckg.config = {};
    Pckg.config.locale = {
        current: '{{ _localeManager.getCurrent() }}',
        decimals: {{ config('pckg.locale.decimals', 2) }},
        format: {
            dateMoment: 'll',
            timeMoment: 'LT'
        },
        currency: '{{ config('pckg.payment.currency', 'EUR') }}',
        currencySign: '{{ config('pckg.payment.currencySign', 'â‚¬') }}'
    };
    Pckg.config.editor = {};
    Pckg.config.editor.variables = {{ config('pckg.dynamic.editor.variables') | json_encode | raw }};

    Pckg.config.cdn = {{ config('storage.cdn') | json_encode | raw }};

    Pckg.config.apis = {};
    Pckg.config.apis.googleConsole = {{ config('external.googleMaps.apiKey', '') | json_encode | raw }};

    Pckg.router = {};
    Pckg.router.urls = {{ _router.getPublicRoutes() | json_encode | raw }};

    Pckg.translations = {{ _translator.getPublicTranslations() | json_encode | raw }};

    Pckg.vue = {};
    Pckg.vue.stores = {};
    Pckg.vue.templates = {};

    Pckg.auth = {};
    Pckg.auth.user = {{ _auth.getUser() | json_encode | raw }};

    {% if _env.isDev() %}
    Vue.config.debug = true;
    Vue.config.silent = false;
    Vue.config.devtools = true;
    {% endif %}

    moment.locale('en');

    Vue.filter('number', function (price) {
        return parseInt(price) == parseFloat(price) ? parseInt(price) : parseFloat(price);
    });

    Vue.filter('price', function (price, decimals) {
        return locale.price(price, decimals);
    });

    Vue.filter('roundPrice', function (price, decimals) {
        return locale.roundPrice(price, decimals);
    });

    Vue.filter('roundNumber', function (price, decimals) {
        return parseInt(price) == parseFloat(price) ? parseInt(price) : parseFloat(price).toFixed(decimals || 2);
    });

    Vue.filter('date', function (date, format) {
        return locale.date(date, format);
    });

    Vue.filter('time', function (date, format) {
        return locale.time(date, format);
    });

    Vue.filter('datetime', function (date, format) {
        return locale.datetime(date, format);
    });

    Vue.filter('timespan', function (timespan) {
        let format = timespan.split(' ')[1];
        let num = parseInt(timespan.split(' ')[0]);
        let ordinal = moment.localeData()._durationLabelsStandard;

        let key = null;
        $.each(ordinal, function(k, v){
            if (v == format) {
                key = k;
                return false;
            }
        });

        let duration = moment.duration(num, format);
        if (!key) {
            return duration.humanize();
        }

        return moment.duration(num, format).format(key + ' __', {trim: 'both'})
    });

    Vue.filter('ucfirst', function (string) {
        if (!string) {
            return '';
        }

        return string.charAt(0).toUpperCase() + string.slice(1);
    });

    Vue.filter('nl2br', function (string) {
        if (!string) {
            return '';
        }

        return utils.nl2br(nl2br);
    });
</script>

{{ _metaManager.getMeta('headerLast') | raw }}