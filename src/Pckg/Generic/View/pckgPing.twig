<script type="text/x-template" id="pckg-ping">
    <div class="pckg-ping">

    </div>
</script>

<script type="text/javascript">
    Vue.component('pckg-ping', {
        name: 'pckg-ping',
        template: '#pckg-ping',
        mixins: [pckgDelimiters, pckgInterval],
        data: function () {
            return {
                lastActivity: moment().unix(),
                lastPing: moment().unix(),
                diff: 5 * 60 // 5 minutes
            };
        },
        created: function () {
            $('body').on('mousemove', this.updateLastActivity);
            this.interval('someInterval', this.performLoginCheck, this.diff * 1000);
        },
        methods: {
            updateLastActivity: function () {
                this.lastActivity = moment().unix();
                if (this.lastActivity - this.lastPing > this.diff) {
                    this.performLoginCheck();
                }
            },
            performLoginCheck: function () {
                this.lastPing = moment().unix();
                http.get('{{ url('api.auth.loginStatus') }}', function (data) {
                    if (data.loggedIn) {
                        return;
                    }

                    confirm('Your session expired, please login in another window');
                    this.performLoginCheck();
                }.bind(this));
            }
        },
        computed: {}
    });
</script>