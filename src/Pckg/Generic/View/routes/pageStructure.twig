<pckg-generic-page-structure></pckg-generic-page-structure>

<div class="pageStructure">
    <script type="text/x-template" id="pckg-generic-page-structure">
        {% embed 'Pckg/Generic/View/modal.twig' with {'close': true, 'id': 'pageStructureModal'} %}
            {% block header %}
                Add action morph
            {% endblock %}
            {% block body %}
                {{ actionMorphForm | raw }}
            {% endblock %}
        {% endembed %}

        <div class="list-group" v-for="variable in variables">
            {% embed 'Pckg/Generic/View/panel.twig' %}
                {% block content %}
                    <h3>Variable: ${ variable.slug }</h3>
                    <a href="#" class="list-group-item" v-for="actionMorph in route.actionsMorphs"
                       v-if="actionMorph.variable_id == variable.id">
                        <h4 class="list-group-item-heading">1 Action: ${ actionMorph.action.slug }</h4>
                        <p>Order: ${ actionMorph.order }</p>
                        <p class="list-group-item-text" v-if="actionMorph.content_id">
                            Content: ${ actionMorph.content_id }
                        </p>
                    </a>
                    <a href="#" class="list-group-item" v-for="actionMorph in layout.actionsMorphs"
                       v-if="actionMorph.variable_id == variable.id">
                        <h4 class="list-group-item-heading">2 Layout action: ${ actionMorph.action.slug }</h4>
                        <p>Order: ${ actionMorph.order }</p>
                        <p class="list-group-item-text" v-if="actionMorph.content_id">
                            Content: ${ actionMorph.content_id }
                        </p>
                    </a>
                    <a href="#" class="list-group-item">
                        <h4 class="list-group-item-heading" v-on:click="addAction">New action</h4>
                    </a>
                {% endblock %}
            {% endembed %}
        </div>
        {% embed 'Pckg/Generic/View/panel.twig' %}
            {% block content %}
                <h3>No variable</h3>
                <a href="#" class="list-group-item" v-for="actionMorph in route.actionsMorphs"
                   v-if="!actionMorph.variable_id">
                    <h4 class="list-group-item-heading">3 Action: ${ actionMorph.action.slug }</h4>
                    <p>Order: ${ actionMorph.order }</p>
                    <p class="list-group-item-text" v-if="actionMorph.content_id">
                        Content: ${ actionMorph.content_id }
                    </p>
                </a>
                <a href="#" class="list-group-item" v-for="actionMorph in layout.actionsMorphs"
                   v-if="!actionMorph.variable_id">
                    <h4 class="list-group-item-heading">4 Layout action: ${ actionMorph.action.slug }</h4>
                    <p>Order: ${ actionMorph.order }</p>
                    <p class="list-group-item-text" v-if="actionMorph.content_id">
                        Content: ${ actionMorph.content_id }
                    </p>
                </a>
                <a href="#" class="list-group-item">
                    <h4 class="list-group-item-heading" v-on:click="addAction">New action</h4>
                </a>
            {% endblock %}
        {% endembed %}
    </script>
    <script type="text/javascript">
        data.variables = {{ variables.toJSON() | raw }};
        data.route = {{ route.toJSON() | raw }};
        data.layout = {% if layout %}{{ layout.toJSON() | raw }}{% else %}{}{% endif %};
        data.formActionMorph = {{ actionsMorph.toJSON() | raw }};

        Vue.component('pckg-generic-page-structure', {
            template: '#pckg-generic-page-structure',
            data: function () {
                return {
                    variables: data.variables,
                    route: data.route,
                    layout: data.layout,
                    form: data.formActionMorph
                };
            },
            methods: {
                addAction: function () {
                    $('#pageStructureModal').modal('show');
                },
                onSubmit: function () {
                    http.submitForm(this)
                            .done(function (json) {
                                console.log('Done', json);
                            });
                }
            }
        });
    </script>

</div>